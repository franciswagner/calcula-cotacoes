package com.ricardococati.service.impl;

import static br.com.six2six.fixturefactory.Fixture.from;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial12PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_001;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial12PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_002;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial12PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_003;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial12PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_004;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial12PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_005;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial12PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_006;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial12PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_007;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial12PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_008;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial12PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_009;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial12PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_010;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial12PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_011;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial12PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_012;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial12PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_013;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial12PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_014;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial12PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_015;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial12PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_016;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial12PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_017;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial12PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_018;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial12PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_019;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial12PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_020;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial26PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_001;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial26PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_002;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial26PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_003;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial26PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_004;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial26PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_005;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial26PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_006;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial26PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_007;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial26PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_008;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial26PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_009;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial26PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_010;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial26PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_011;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial26PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_012;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial26PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_013;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial26PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_014;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial26PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_015;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial26PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_016;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial26PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_017;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial26PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_018;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial26PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_019;
import static com.ricardococati.service.impl.templates.MediaMovelExponencial26PeriodosSemanalTemplateLoader.MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_020;
import static org.assertj.core.api.Assertions.assertThat;
import static org.junit.Assert.assertTrue;
import static org.mockito.Matchers.any;
import static org.mockito.Mockito.when;

import br.com.six2six.fixturefactory.loader.FixtureFactoryLoader;
import com.ricardococati.model.entities.MacdSemanal;
import com.ricardococati.model.entities.MediaMovelExponencialSemanal;
import com.ricardococati.repository.dao.MacdSemanalBuscarDAO;
import com.ricardococati.repository.dao.MacdSemanalInserirDAO;
import com.ricardococati.repository.dao.MediaMovelExponencialSemanalBuscarDAO;
import java.math.BigDecimal;
import java.time.LocalDate;
import java.util.List;
import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.runners.MockitoJUnitRunner;

@RunWith(MockitoJUnitRunner.class)
public class MACDSemanalCalculaServiceImplTest {

  @InjectMocks
  private MACDSemanalCalculaServiceImpl target;
  @Mock
  private MediaMovelExponencialSemanalBuscarDAO mmeDAO;
  @Mock
  private MacdSemanalInserirDAO macdInserirDAO;
  @Mock
  private MacdSemanalBuscarDAO macdDAO;

  @Before
  public void setUp() throws Exception {
    FixtureFactoryLoader.loadTemplates("com.ricardococati.service.impl.templates");
  }

  @Test
  public void executeByCodNeg() {
    //given
    when(mmeDAO.getListMMEByCodNegEPeriodo(any(), any())).thenReturn(mediaMovelExponencialPeriodosSemanalList());
    //when
    List<MacdSemanal> result = target.executeByCodNeg("MGLU3");
    //then
    assertTrue(!result.isEmpty());
    assertThat(result).isNotNull().size().isEqualTo(80);
    assertThat(result.get(0).getDtpregini()).isNotNull().isEqualTo(LocalDate.of(1978, 2, 16));
    assertThat(result.get(0).getMacd().getPremacd()).isNotNull().isEqualTo(new BigDecimal("0.0000"));
    assertThat(result.get(1).getDtpregini()).isNotNull().isEqualTo(LocalDate.of(1978, 2, 16));
    assertThat(result.get(1).getMacd().getPremacd()).isNotNull().isEqualTo(new BigDecimal("1.0000"));
    assertThat(result.get(19).getDtpregini()).isNotNull().isEqualTo(LocalDate.of(1978, 3, 7));
    assertThat(result.get(19).getMacd().getPremacd()).isNotNull().isEqualTo(new BigDecimal("1.0000"));
  }

  @Test
  public void executeByCodNegNull() {
    //given
    when(mmeDAO.getListMMEByCodNegEPeriodo(any(), any())).thenReturn(null);
    //when
    List<MacdSemanal> result = target.executeByCodNeg("MGLU3");
    //then
    assertThat(result).isNotNull();
  }

  private List<MediaMovelExponencialSemanal> mediaMovelExponencialPeriodosSemanalList(){
    return from(MediaMovelExponencialSemanal.class)
        .gimme(40,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_001,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_002,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_003,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_004,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_005,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_006,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_007,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_008,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_009,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_010,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_011,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_012,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_013,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_014,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_015,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_016,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_017,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_018,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_019,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_12PERIODOS_VALID_020,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_001,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_002,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_003,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_004,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_005,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_006,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_007,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_008,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_009,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_010,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_011,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_012,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_013,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_014,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_015,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_016,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_017,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_018,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_019,
            MEDIA_MOVEL_EXPONENCIAL_SEMANAL_26PERIODOS_VALID_020
        );
  }
}